---
apiVersion: kubeadm.k8s.io/v1beta4
kind: JoinConfiguration
nodeRegistration:
  name: "{{ inventory_hostname }}"
  kubeletExtraArgs:
    - name: "cgroup-driver"
      value: "systemd"
discovery:
  bootstrapToken:
{% if (groups['master'] | length) > 1 %}
    apiServerEndpoint: "{{ k8s_ha_virtual_ip }}:6443"
{% else %}
    apiServerEndpoint: "{{ hostvars[groups['master'][0]]['advertise_ip'] }}:6443"
{% endif %}
    token: "{{ hostvars[groups['master'][0]]['kubeadm_token'] }}"
    caCertHashes:
      - "sha256:{{ hostvars[groups['master'][0]]['kubeadm_ca_hash'] }}"
    unsafeSkipCAVerification: false